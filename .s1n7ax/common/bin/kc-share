#!/bin/env bash

set -euxo pipefail

if [[ $# -eq 0 ]] ; then
	echo 'Path to share should be passed'
	exit 1
fi

function find_files {
	if [ -d "$1" ]; then
		find $1 -type f
	else
		echo $1
	fi
}

AVAILABLE=$(kdeconnect-cli --list-available --name-only)
DEVICE_COUNT=$(echo "$AVAILABLE" | wc -l)

if [ $DEVICE_COUNT -gt 1 ]; then
	PICKED_DEVICE=$(echo "$AVAILABLE" | dmenu)
else
	PICKED_DEVICE=$AVAILABLE
fi

for path in "$@"; do
	find_files "$path" | xargs -I{} kdeconnect-cli --name="$PICKED_DEVICE" --share="{}"
done
